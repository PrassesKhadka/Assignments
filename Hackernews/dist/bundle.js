(()=>{"use strict";var e=function(e,n,t,r){return new(t||(t=Promise))((function(a,c){function o(e){try{s(r.next(e))}catch(e){c(e)}}function i(e){try{s(r.throw(e))}catch(e){c(e)}}function s(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,i)}s((r=r.apply(e,n||[])).next())}))},n=function(e,n){var t,r,a,c,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return c={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(o=0)),o;)try{if(t=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=n.call(e,o)}catch(e){i=[6,e],r=0}finally{t=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function t(){return{getStories:function(){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,fetch("https://hacker-news.firebaseio.com/v0/topstories.json?print=pretty")];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}}))}))},getStory:function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,fetch("https://hacker-news.firebaseio.com/v0/item/".concat(t,".json?print=pretty"))];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}}))}))},getComment:function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,fetch("https://hacker-news.firebaseio.com/v0/item/".concat(t,".json?print=pretty"))];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}}))}))}}}var r=function(e){var n=(new Date).getTime(),t=1e3*e,r=Math.floor((n-t)/1e3),a=Math.floor(r/86400);return a>=1&&a<=6?"".concat(a,1===a?" day ago":" days ago"):a>6?new Date(t).toLocaleDateString():(a=Math.floor(r/3600))>=1?"".concat(a,1===a?" hour ago":" hours ago"):(a=Math.floor(r/60))>=1?"".concat(a,1===a?" minute ago":" minutes ago"):a<1?"Just now":void 0},a=function(e,n,t,r){return new(t||(t=Promise))((function(a,c){function o(e){try{s(r.next(e))}catch(e){c(e)}}function i(e){try{s(r.throw(e))}catch(e){c(e)}}function s(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,i)}s((r=r.apply(e,n||[])).next())}))},c=function(e,n){var t,r,a,c,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return c={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(o=0)),o;)try{if(t=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=n.call(e,o)}catch(e){i=[6,e],r=0}finally{t=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},o=document.querySelector(".inner-container"),i=document.querySelectorAll(".nav-btn"),s=document.querySelector(".next-btn"),l=document.querySelector(".previous-btn"),u=function(e){void 0===e&&(e=10);var n=1,o=1,i=[],s=[],l=[],u={};function d(){return a(this,void 0,void 0,(function(){var r,o,d,m,f,p=this;return c(this,(function(v){switch(v.label){case 0:return 0!==i.length?[3,2]:[4,t().getStories()];case 1:i=v.sent(),v.label=2;case 2:return r=(n-1)*e,o=n*e,s=i.slice(r,o),u[n.toString()]?(l=u[n],[3,7]):[3,3];case 3:return[4,s.map((function(e){return a(p,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return[4,t().getStory(e)];case 1:return[2,n.sent()]}}))}))}))];case 4:return d=v.sent(),[4,Promise.all(d)];case 5:return l=v.sent(),m=u,f=n.toString(),[4,Promise.all(d)];case 6:m[f]=v.sent(),v.label=7;case 7:return[2]}}))}))}function m(e){return a(this,void 0,void 0,(function(){var n,o=this;return c(this,(function(i){return document.querySelector(".inner-comment-box"),(n=document.createElement("div")).classList.add("inner-comment-box"),e.forEach((function(e){return a(o,void 0,void 0,(function(){function o(){return a(this,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return!1!==g?[3,4]:(g=!0,l?[3,1]:(E.removeEventListener("click",o),[3,3]));case 1:return[4,m(l)];case 2:e=n.sent(),f.append(e),n.label=3;case 3:return[3,5];case 4:f.querySelector(".inner-comment-box").querySelectorAll(".comment").forEach((function(e){return e.classList.toggle("hide")})),n.label=5;case 5:return[2]}}))}))}var i,s,l,u,d,f,p,v,h,b,L,y,E,g;return c(this,(function(a){switch(a.label){case 0:return[4,t().getComment(e)];case 1:return i=a.sent(),s=i.by,l=i.kids,u=i.text,d=i.time,(f=document.createElement("div")).classList.add("comment"),(p=document.createElement("div")).classList.add("user-icon"),(v=document.createElement("span")).classList.add("material-icons"),v.textContent="person",p.appendChild(v),(h=document.createElement("div")).classList.add("user-details"),(b=document.createElement("p")).textContent="".concat(s),b.classList.add("user-name"),(L=document.createElement("span")).textContent=r(d),L.classList.add("comment-time"),(y=document.createElement("div")).classList.add("comment-text"),y.innerHTML=u,(E=document.createElement("div")).classList.add("reply-icon"),E.innerHTML='\n          <span class="material-icons">comment</span>\n          '.concat(l?"<span>".concat(l.length,"</span>"):"<span>0</span>","\n      "),h.append(b,L),f.append(p,h,y,E),n.append(f),g=!1,E.addEventListener("click",o),[2]}}))}))})),[2,n]}))}))}function f(){var e=document.querySelector(".bookmark"),n=JSON.parse(localStorage.getItem("bookmark"))||[];e.innerHTML="",n.forEach((function(n){p(n,e)}))}function p(e,n){var t=e.by,o=e.time,i=e.url,s=e.title,l=e.kids,u=e.score,d=document.createElement("div");d.classList.add("box");var p=document.createElement("div");p.classList.add("upper-box");var v=document.createElement("div");v.classList.add("lower-box");var h=document.createElement("div");h.classList.add("title"),h.textContent=s;var b=document.createElement("div");b.innerHTML='<div class="author"><span class="material-icons">person</span> '.concat(t,"</div>");var L=document.createElement("div");L.classList.add("comment-box"),L.innerHTML='<span class="material-icons">comment</span><span>'.concat(l?l.length:"0","</span>");var y=document.createElement("div");y.classList.add("score"),y.innerHTML='<span class="material-icons">star</span><span>'.concat(u,"</span>");var E=document.createElement("div");E.classList.add("time"),E.innerHTML='<i class="material-icons">access_time</i> Published '.concat(r(o));var g=document.createElement("div"),k=document.createElement("a");k.href=i,k.target="_blank",k.innerHTML='<span class="material-icons">open_in_new</span>',g.append(k);var x=document.createElement("span");x.classList.add("save"),x.innerHTML='<span class="material-icons">bookmark</span>',p.append(h),v.append(b,y,L,E,g,x),d.append(p,v),n.appendChild(d),h.addEventListener("click",(function(){!function(e){a(this,void 0,void 0,(function(){var n,t,a,o,i,s,l,u,d,f,p,v,h,b,L,y;return c(this,(function(c){switch(c.label){case 0:return n=e.by,t=e.kids,e.score,a=e.time,o=e.title,i=e.url,s=document.querySelector(".inner-container"),l=document.querySelector(".bookmark"),(u=document.createElement("div")).classList.add("comment-box"),l.innerHTML="",s.innerHTML="",(d=document.createElement("div")).classList.add("box"),(f=document.createElement("h2")).textContent=o,(p=document.createElement("p")).textContent="".concat(n),v=document.createElement("div"),(h=document.createElement("a")).href=i,h.target="_blank",h.innerHTML='<span class="material-icons">open_in_new</span>',v.append(h),(b=document.createElement("p")).textContent=r(a),(L=document.createElement("p")).innerHTML='<span class="material-icons">comment</span> '.concat(t.length?t.length:"0"),d.appendChild(f),d.appendChild(p),d.appendChild(v),d.appendChild(b),d.appendChild(L),0!==t.length?[3,1]:(s.innerHTML="No Comments to Show",[3,3]);case 1:return[4,m(t)];case 2:y=c.sent(),u.append(y),c.label=3;case 3:return s.append(d,u),[2]}}))}))}(e)}));var w=!1;x.addEventListener("click",(function(){w=!w,console.log(w);var n=document.querySelector(".bookmark");document.querySelector(".save").getElementsByTagName("span")[0].style.color=w?"blue":"white";var t=JSON.parse(localStorage.getItem("bookmark"))||[],r=t.findIndex((function(n){return n.id===e.id}));-1===r?t.push(e):t.splice(r,1),localStorage.setItem("bookmark",JSON.stringify(t)),n.innerHTML="",f()}))}return{indexNo:n,nextPage:function(){n=9+(o=o%10+1)},previousPage:function(){o--,(n=o-9)<1&&(n=(o=10)-9)},goToIndex:function(e){return n=e},render:function(){return a(this,void 0,void 0,(function(){var n;return c(this,(function(t){switch(t.label){case 0:return n=document.querySelector(".inner-container"),f(),function(){for(var n=document.querySelector(".inner-container"),t=0;t<e;t++){var r=document.createElement("div");r.innerHTML='\n                <div class="box">\n                    <div class="skeleton skeleton-text"></div>\n                    <div class="skeleton skeleton-text"></div>\n                    <div class="skeleton skeleton-text"></div>\n                    <div class="skeleton skeleton-text"></div>\n                    <div class="skeleton skeleton-text"></div>\n                </div>\n            ',n.appendChild(r)}}(),[4,d()];case 1:return t.sent(),n.innerHTML="",l.forEach((function(e){p(e,n)})),[2]}}))}))}}}(5),d=u.nextPage,m=u.previousPage,f=u.goToIndex,p=u.render;i.forEach((function(e,n){e.addEventListener("click",(function(){o.innerHTML="",f(n+1),p(),i.forEach((function(e){e.classList.remove("active")})),e.classList.add("active")}))})),s.addEventListener("click",(function(){o.innerHTML="",d(),p();var e=1;i.forEach((function(n,t){n.classList.contains("active")&&(e=t),n.classList.remove("active")})),i.forEach((function(n,t){t===e+1&&n.classList.add("active")}))})),l.addEventListener("click",(function(){o.innerHTML="",m(),p();var e=1;i.forEach((function(n,t){n.classList.contains("active")&&(e=t),n.classList.remove("active")})),i.forEach((function(n,t){0!=e&&t===e-1&&n.classList.add("active"),0===e&&0===t&&n.classList.add("active")}))})),p()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNsQkcsRUFBSXZFLFVBQVV5RSxTQUFTLFlBQ3RCaEIsRUFBTVcsR0FFVkcsRUFBSXZFLFVBQVV3RSxPQUFPLFNBQ3pCLElBQ0FqRyxFQUFZMkIsU0FBUSxTQUFDcUUsRUFBSUgsR0FDWCxHQUFQWCxHQUFZVyxJQUFJWCxFQUFNLEdBRXJCYyxFQUFJdkUsVUFBVUMsSUFBSSxVQUVYLElBQVJ3RCxHQUFpQixJQUFKVyxHQUVaRyxFQUFJdkUsVUFBVUMsSUFBSSxTQUcxQixHQUNKLElBR0FrRSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaGFja2VybmV3cy8uL3NyYy9hcGkvZGF0YS50cyIsIndlYnBhY2s6Ly9oYWNrZXJuZXdzLy4vc3JjL3V0aWxzLnRzL3RpbWVTaW5jZS50cyIsIndlYnBhY2s6Ly9oYWNrZXJuZXdzLy4vc3JjL2luZGV4LnRzIiwid2VicGFjazovL2hhY2tlcm5ld3MvLi9zcmMvZmFjdG9yaWVzL3BhZ2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSXJldHVybkdldENvbW1lbnRzLCBJcmV0dXJuR2V0U3RvcnkgfSBmcm9tIFwiLi4vaW50ZXJmYWNlXCI7XG5cbmludGVyZmFjZSBJcmV0dXJuR2V0RGF0YXtcbiAgICBnZXRTdG9yaWVzOigpPT5Qcm9taXNlPG51bWJlcltdPjtcbiAgICBnZXRTdG9yeTooaWQ6bnVtYmVyKT0+UHJvbWlzZTxJcmV0dXJuR2V0U3Rvcnk+O1xuICAgIGdldENvbW1lbnQ6KGlkOm51bWJlcik9PlByb21pc2U8SXJldHVybkdldENvbW1lbnRzPjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldERhdGEoKTpJcmV0dXJuR2V0RGF0YXtcbiAgICAvLyBlbmRwb2ludHM6XG5cbiAgICAvLyB0b3AgNTAwIHN0b3JpZXMgZW5kcG9pbnRzOlxuICAgIGFzeW5jIGZ1bmN0aW9uIGdldFN0b3JpZXMoKTogUHJvbWlzZTxudW1iZXJbXT57XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlPSBhd2FpdCBmZXRjaChcImh0dHBzOi8vaGFja2VyLW5ld3MuZmlyZWJhc2Vpby5jb20vdjAvdG9wc3Rvcmllcy5qc29uP3ByaW50PXByZXR0eVwiKVxuICAgICAgICBjb25zdCBkYXRhPWF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG4gICAgLy8gZWFjaCBzdG9yeVxuICAgIGFzeW5jIGZ1bmN0aW9uIGdldFN0b3J5KGlkOm51bWJlcik6UHJvbWlzZTxJcmV0dXJuR2V0U3Rvcnk+e1xuICAgICAgICBjb25zdCByZXNwb25zZT1hd2FpdCBmZXRjaChgaHR0cHM6Ly9oYWNrZXItbmV3cy5maXJlYmFzZWlvLmNvbS92MC9pdGVtLyR7aWR9Lmpzb24/cHJpbnQ9cHJldHR5YClcbiAgICAgICAgY29uc3QgZGF0YT1hd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cblxuICAgIC8vIGVhY2ggY29tbWVudFxuICAgIGFzeW5jIGZ1bmN0aW9uIGdldENvbW1lbnQoaWQ6bnVtYmVyKTpQcm9taXNlPElyZXR1cm5HZXRDb21tZW50cz57XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlPWF3YWl0IGZldGNoKGBodHRwczovL2hhY2tlci1uZXdzLmZpcmViYXNlaW8uY29tL3YwL2l0ZW0vJHtpZH0uanNvbj9wcmludD1wcmV0dHlgKVxuICAgICAgICBjb25zdCBkYXRhPWF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB7Z2V0U3RvcmllcyxnZXRTdG9yeSxnZXRDb21tZW50fVxufVxuIiwiLy8gVW5peCBjb2RlIGRhdGUgY29udmVydGVyIGZ1bmN0aW9uXG4vLyBVbml4IGNvZGU6IHRpbWUgaW4gc2Vjb25kIGVsYXBzZWQgYWZ0ZXIgSkFOVUFSWSAxLCAxOTcwXG5cbmV4cG9ydCBjb25zdCB0aW1lU2luY2UgPSAoZGF0ZTogbnVtYmVyKTpzdHJpbmcgPT4ge1xuICAgIC8vIGRhdGUgZ290dGVuIGluIHVuaXggY29kZVxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgLy8gZ290dGVuIGluIHVuaXggY29kZSBcbiAgICBjb25zdCBub3dTZWNvbmRzID0gbm93LmdldFRpbWUoKTtcbiAgICAvLyBjb252ZXJ0ZWQgc2Vjb25kIGluIG1pbGxpc2Vjb25kXG4gICAgY29uc3QgZGF0ZVNlYyA9IGRhdGUgKjEwMDA7XG4gICAgLy8gc2Vjb25kcyBlbGFwc2VkIHNpbmNlIHBvc3QgLzEwMDA9PiB0byBjb252ZXJ0IG1pbGxpc2Vjb25kIHRvIHNlY29uZFxuICAgIGNvbnN0IHNlY29uZHMgPSBNYXRoLmZsb29yKChub3dTZWNvbmRzIC0gZGF0ZVNlYykvMTAwMCk7XG5cbiAgICAvLyBpbnRlcnZhbCBpbiBkYXlzXG4gICAgbGV0IGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gODY0MDApO1xuXG4gICAgaWYgKGludGVydmFsID49IDEgJiYgaW50ZXJ2YWwgPD0gNikge1xuICAgICAgICBpZiAoaW50ZXJ2YWwgPT09IDEpIHJldHVybiBgJHtpbnRlcnZhbH0gZGF5IGFnb2BcbiAgICAgICAgZWxzZSByZXR1cm4gYCR7aW50ZXJ2YWx9IGRheXMgYWdvYFxuICAgIH0gZWxzZSBpZiAoaW50ZXJ2YWwgPiA2KSB7XG4gICAgICAgIC8vIHVuaXggY29kZSBkYXRlU2VjIGluIG1pbGxpc2VjIGFzIHBhcmFtZXRlclxuICAgICAgICBsZXQgY3JlYXRlZCA9IG5ldyBEYXRlKGRhdGVTZWMpO1xuICAgICAgICAvLyBjb252ZXJ0cyBpbnRvIHRoZSBkYXRlIFxuICAgICAgICByZXR1cm4gY3JlYXRlZC50b0xvY2FsZURhdGVTdHJpbmcoKTtcbiAgICB9XG5cbiAgICAvLyBpbnRlcnZhbCBpbiBob3Vyc1xuICAgIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gMzYwMCk7XG5cbiAgICBpZiAoaW50ZXJ2YWwgPj0gMSkge1xuICAgICAgICBpZiAoaW50ZXJ2YWwgPT09IDEpIHJldHVybiBgJHtpbnRlcnZhbH0gaG91ciBhZ29gXG4gICAgICAgIGVsc2UgcmV0dXJuIGAke2ludGVydmFsfSBob3VycyBhZ29gXG4gICAgfVxuXG4gICAgLy8gaW50ZXJ2YWwgaW4gbWludXRlc1xuICAgIFxuICAgIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gNjApO1xuICAgIGlmIChpbnRlcnZhbCA+PSAxKSB7XG4gICAgICAgIGlmIChpbnRlcnZhbCA9PT0gMSkgcmV0dXJuIGAke2ludGVydmFsfSBtaW51dGUgYWdvYFxuICAgICAgICBlbHNlIHJldHVybiBgJHtpbnRlcnZhbH0gbWludXRlcyBhZ29gXG4gICAgfSBlbHNlIGlmIChpbnRlcnZhbCA8IDEpIHJldHVybiAnSnVzdCBub3cnXG59IiwiaW1wb3J0IHsgUGFnZSB9IGZyb20gXCIuL2ZhY3Rvcmllcy9wYWdlXCI7XG5cbi8vIHNlbGVjdG9yczpcbmNvbnN0IGlubmVyX2NvbnRhaW5lcj1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmlubmVyLWNvbnRhaW5lclwiKVxuY29uc3QgbmF2aWdhdGlvbnM9ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5uYXYtYnRuXCIpXG5jb25zdCBuZXh0X2J0bj1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm5leHQtYnRuXCIpXG5jb25zdCBwcmV2X2J0bj1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByZXZpb3VzLWJ0blwiKVxuXG5cbi8vIEtlZXBpbmcgNSBzdG9yaWVzIG9uIGVhY2ggcGFnZTtcbmNvbnN0IHsgbmV4dFBhZ2UsIHByZXZpb3VzUGFnZSwgZ29Ub0luZGV4LCByZW5kZXIgfSA9IFBhZ2UoNSk7XG5cbi8vIEZvciBldmVudCBMaXN0ZW5lcnMgXG4vLyB3aGVuIG5hdmlnYXRpb24gYnV0dG9ucyBjbGlja2VkXG5uYXZpZ2F0aW9ucy5mb3JFYWNoKChlbGVtZW50OkhUTUxCdXR0b25FbGVtZW50LGluZGV4Om51bWJlcik9PntcbiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCgpPT57XG4gICAgICAgIGlubmVyX2NvbnRhaW5lci5pbm5lckhUTUw9XCJcIlxuICAgICAgICBnb1RvSW5kZXgoaW5kZXgrMSlcbiAgICAgICAgcmVuZGVyKClcblxuICAgICAgICAvLyBhZGQgYWN0aXZlIGNsYXNzIHRvIHNob3ctPnRoYXQgc3BlY2lmaWMgYnV0dG9uIGFjdGl2ZSB3aGVuIGNsaWNrZWQ7XG4gICAgICAgIG5hdmlnYXRpb25zLmZvckVhY2goKGJ0bik9PntcbiAgICAgICAgICAgIGJ0bi5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpXG5cbiAgICAgICAgfSlcbiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpIFxuICAgIH0pXG59KVxuXG4vLyB3aGVuIG5leHQgYnV0dG9uIGNsaWNrZWRcbm5leHRfYnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCgpPT57XG4gICAgaW5uZXJfY29udGFpbmVyLmlubmVySFRNTD1cIlwiXG4gICAgbmV4dFBhZ2UoKVxuICAgIHJlbmRlcigpXG5cbiAgICAvLyBUbyBhZGQgYWN0aXZlIGNsYXNzIHRvIHRoZSBidXR0b25zXG4gICAgbGV0IGluZGV4PTE7XG4gICAgbmF2aWdhdGlvbnMuZm9yRWFjaCgoYnRuLGkpPT57XG4gICAgICAgIGlmKGJ0bi5jbGFzc0xpc3QuY29udGFpbnMoXCJhY3RpdmVcIikpe1xuICAgICAgICAgICAgaW5kZXg9aVxuICAgICAgICB9XG4gICAgICAgIGJ0bi5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpXG4gICAgfSlcbiAgICBuYXZpZ2F0aW9ucy5mb3JFYWNoKChidG4saSk9PntcbiAgICAgICAgaWYoaT09PWluZGV4KzEpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpXG4gICAgICAgIH1cblxuICAgIH0pXG59KVxuXG4vLyB3aGVuIHByZXZpb3VzIGJ1dHRvbiBjbGlja2VkXG5wcmV2X2J0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwoKT0+e1xuICAgIGlubmVyX2NvbnRhaW5lci5pbm5lckhUTUw9XCJcIlxuICAgIHByZXZpb3VzUGFnZSgpXG4gICAgcmVuZGVyKClcblxuICAgIC8vIFRvIGFkZCBhY3RpdmUgY2xhc3MgdG8gdGhlIGJ1dHRvbnNcbiAgICBsZXQgaW5kZXg9MTtcbiAgICBuYXZpZ2F0aW9ucy5mb3JFYWNoKChidG4saSk9PntcbiAgICAgICAgaWYoYnRuLmNsYXNzTGlzdC5jb250YWlucyhcImFjdGl2ZVwiKSl7XG4gICAgICAgICAgICBpbmRleD1pXG4gICAgICAgIH1cbiAgICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIilcbiAgICB9KVxuICAgIG5hdmlnYXRpb25zLmZvckVhY2goKGJ0bixpKT0+e1xuICAgICAgICBpZihpbmRleCE9MCAmJiBpPT09aW5kZXgtMSlcbiAgICAgICAge1xuICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIilcbiAgICAgICAgfVxuICAgICAgICBpZihpbmRleD09PTAgJiYgaT09PTApXG4gICAgICAgIHtcbiAgICAgICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpXG4gICAgICAgIH1cblxuICAgIH0pXG59KVxuXG4vLyBpbml0aWFsIHJlbmRlciAxc3QgcGFnZVxucmVuZGVyKCk7XG4iLCJpbXBvcnQgeyBmaW5kSW5kZXgsIGxvd2VyQ2FzZSB9IGZyb20gXCJjeXByZXNzL3R5cGVzL2xvZGFzaFwiO1xuaW1wb3J0IHsgZ2V0RGF0YSB9IGZyb20gXCIuLi9hcGkvZGF0YVwiO1xuaW1wb3J0IHsgSXJldHVybkdldENvbW1lbnRzLCBJcmV0dXJuR2V0U3RvcnkgfSBmcm9tIFwiLi4vaW50ZXJmYWNlXCI7XG5pbXBvcnQgeyB0aW1lU2luY2UgfSBmcm9tIFwiLi4vdXRpbHMudHMvdGltZVNpbmNlXCI7XG5pbXBvcnQgeyByZW5kZXJCb29rbWFyayB9IGZyb20gXCIuLi91dGlscy50cy9ib29rbWFya1wiO1xuXG5pbnRlcmZhY2UgSXJldHVyblBhZ2Uge1xuICBpbmRleE5vOiBudW1iZXI7XG4gIG5leHRQYWdlOiAoKSA9PiB2b2lkO1xuICBwcmV2aW91c1BhZ2U6ICgpID0+IHZvaWQ7XG4gIGdvVG9JbmRleDogKG5vOiBudW1iZXIpID0+IHZvaWQ7XG4gIHJlbmRlcjogKCkgPT4gdm9pZDtcbn1cblxuaW50ZXJmYWNlIElzdG9yeUNhY2hlIHtcbiAgW2tleTogc3RyaW5nXTogSXJldHVybkdldFN0b3J5W107XG59XG5cbi8vIGFzIGRlZmF1bHQgZWFjaCBpbmRleCBoYXMgMTAgc3Rvcmllc1xuZXhwb3J0IGZ1bmN0aW9uIFBhZ2UoZWFjaEluZGV4OiBudW1iZXIgPSAxMCk6IElyZXR1cm5QYWdlIHtcbiAgLy8gYnV0dG9uc1xuICBsZXQgdG90YWxJbmRleCA9IDUwO1xuICBsZXQgaW5kZXhObyA9IDE7XG4gIC8vcGFnZSBpcyB0aGUgcGFnZSBpLmUgbmF2LWJhciAxLTEwIGlzIHBhZ2UgMSBhbm90aGVyIDExLTIwIGlzIHBhZ2UgMiBzaW1pbGFybHkgMTAgcGFnZXNcbiAgbGV0IHRvdGFsUGFnZSA9IDEwO1xuICBsZXQgcGFnZSA9IDE7XG5cbiAgLy8gYWxsIHN0b3JpZXNcbiAgbGV0IHN0b3JpZXM6IG51bWJlcltdID0gW107XG4gIC8vIGNob3NlbiBzdG9yaWVzIGZvciB0aGlzIHBhZ2VcbiAgbGV0IHRvcFN0b3JpZXM6IG51bWJlcltdID0gW107XG4gIGxldCBzdG9yeTogSXJldHVybkdldFN0b3J5W10gPSBbXTtcbiAgbGV0IHN0b3J5Q2FjaGU6IElzdG9yeUNhY2hlID0ge307XG5cbiAgY29uc3QgbmV4dFBhZ2UgPSAoKSA9PiB7XG4gICAgcGFnZSA9IChwYWdlICUgdG90YWxQYWdlKSArIDE7XG4gICAgaW5kZXhObyA9IHBhZ2UgKyA5O1xuICB9O1xuICBjb25zdCBwcmV2aW91c1BhZ2UgPSAoKSA9PiB7XG4gICAgcGFnZS0tO1xuICAgIGluZGV4Tm8gPSBwYWdlIC0gOTtcbiAgICBpZiAoaW5kZXhObyA8IDEpIHtcbiAgICAgIHBhZ2UgPSB0b3RhbFBhZ2U7XG4gICAgICBpbmRleE5vID0gcGFnZSAtIDk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdvVG9JbmRleCA9IChubzogbnVtYmVyKSA9PiAoaW5kZXhObyA9IG5vKTtcblxuICAvLyBkYXRhIGZpbHRlcmVkIGJhc2VkIG9uIHRoZSBpbmRleE5vLiBFZzpmb3IgZmlyc3QgcGFnZSBvbmx5IDAtOSBkYXRhIGdpdmVuXG4gIGFzeW5jIGZ1bmN0aW9uIGRhdGFGaWx0ZXIoKSB7XG4gICAgLy8gRmV0Y2ggdGhlIDUwMCB0b3Agc3Rvcmllc1xuICAgIGlmIChzdG9yaWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgc3RvcmllcyA9IGF3YWl0IGdldERhdGEoKS5nZXRTdG9yaWVzKCk7XG4gICAgfVxuICAgIGxldCBzdGFydCA9IChpbmRleE5vIC0gMSkgKiBlYWNoSW5kZXg7XG4gICAgbGV0IGVuZCA9IGluZGV4Tm8gKiBlYWNoSW5kZXg7XG4gICAgLy8gT25seSBrZWVwIHRoZSBzdG9yaWVzIHRoYXQgd2UgbmVlZCBpbiB0aGlzIHBhZ2UgI2lkJ3NcbiAgICB0b3BTdG9yaWVzID0gc3Rvcmllcy5zbGljZShzdGFydCwgZW5kKTtcblxuICAgIC8vIGZldGNoIHRoZSBzdG9yeVxuXG4gICAgLy8gY2FjaGluZ1xuICAgIGlmIChzdG9yeUNhY2hlW2luZGV4Tm8udG9TdHJpbmcoKV0pIHtcbiAgICAgIHN0b3J5ID0gc3RvcnlDYWNoZVtpbmRleE5vXTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgc3RvcnlQcm9taXNlID0gYXdhaXQgdG9wU3Rvcmllcy5tYXAoYXN5bmMgKGlkKSA9PiB7XG4gICAgICAgIGNvbnN0IGVhY2hTdG9yeSA9IGF3YWl0IGdldERhdGEoKS5nZXRTdG9yeShpZCk7XG4gICAgICAgIHJldHVybiBlYWNoU3Rvcnk7XG4gICAgICB9KTtcbiAgICAgIHN0b3J5ID0gYXdhaXQgUHJvbWlzZS5hbGwoc3RvcnlQcm9taXNlKTtcbiAgICAgIC8vIGNhY2hlXG4gICAgICBzdG9yeUNhY2hlW2luZGV4Tm8udG9TdHJpbmcoKV0gPSBhd2FpdCBQcm9taXNlLmFsbChzdG9yeVByb21pc2UpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFRvIHJlbmRlciBza2VsZXRvbiBsb2FkaW5nIHBhZ2U6XG4gIGZ1bmN0aW9uIHJlbmRlclNrZWxldG9uKCkge1xuICAgIGNvbnN0IGlubmVyQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5pbm5lci1jb250YWluZXJcIik7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlYWNoSW5kZXg7IGkrKykge1xuICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIGRpdi5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImJveFwiPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic2tlbGV0b24gc2tlbGV0b24tdGV4dFwiPjwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic2tlbGV0b24gc2tlbGV0b24tdGV4dFwiPjwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic2tlbGV0b24gc2tlbGV0b24tdGV4dFwiPjwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic2tlbGV0b24gc2tlbGV0b24tdGV4dFwiPjwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic2tlbGV0b24gc2tlbGV0b24tdGV4dFwiPjwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgYDtcbiAgICAgIGlubmVyQ29udGFpbmVyLmFwcGVuZENoaWxkKGRpdik7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZnVuY3Rpb24gcmVuZGVyQ29tbWVudHMoY29tbWVudHM6IG51bWJlcltdKTogUHJvbWlzZTxIVE1MRWxlbWVudD4ge1xuICAgIC8vIHNlbGVjdG9yXG4gICAgY29uc3QgaW5uZXJfY29tbWVudF9ib3ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmlubmVyLWNvbW1lbnQtYm94XCIpO1xuXG4gICAgLy8gY3JlYXRpbmcgYSBkaXYgdG8gcmV0dXJuIGFmdGVyIGFwcGVuZGluZ1xuICAgIGNvbnN0IG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIG5vZGUuY2xhc3NMaXN0LmFkZChcImlubmVyLWNvbW1lbnQtYm94XCIpO1xuXG4gICAgY29tbWVudHMuZm9yRWFjaChhc3luYyAoaWQ6IG51bWJlcikgPT4ge1xuICAgICAgLy8gZGF0YSBmZXRjaFxuICAgICAgY29uc3QgZGF0YTogSXJldHVybkdldENvbW1lbnRzID0gYXdhaXQgZ2V0RGF0YSgpLmdldENvbW1lbnQoaWQpO1xuICAgICAgLy8gZGF0YSBuZWRkZWQ6XG4gICAgICBjb25zdCB7IGJ5LCBraWRzLCB0ZXh0LCB0aW1lIH0gPSBkYXRhO1xuXG4gICAgICAvLyBDcmVhdGUgY29udGFpbmVyIGRpdlxuICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIGRpdi5jbGFzc0xpc3QuYWRkKFwiY29tbWVudFwiKTtcblxuICAgICAgLy8gQ3JlYXRlIHVzZXIgSWNvblxuICAgICAgY29uc3QgdXNlckljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgdXNlckljb24uY2xhc3NMaXN0LmFkZChcInVzZXItaWNvblwiKTtcblxuICAgICAgLy8gQ3JlYXRlIGFuIGljb24gZWxlbWVudCAoTWF0ZXJpYWwgSWNvbnMgdXNlciBpY29uKVxuICAgICAgY29uc3QgaWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKFwibWF0ZXJpYWwtaWNvbnNcIik7XG4gICAgICBpY29uLnRleHRDb250ZW50ID0gXCJwZXJzb25cIjsgLy8gU2V0IHRoZSBNYXRlcmlhbCBJY29ucyBjbGFzcyBmb3IgdGhlIHVzZXIgaWNvblxuXG4gICAgICAvLyBBcHBlbmQgdGhlIGljb24gdG8gdGhlIHVzZXIgaWNvbiBkaXZcbiAgICAgIHVzZXJJY29uLmFwcGVuZENoaWxkKGljb24pO1xuXG4gICAgICAvLyBDcmVhdGUgdXNlciBkZXRhaWxzXG4gICAgICBjb25zdCB1c2VyRGV0YWlscyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICB1c2VyRGV0YWlscy5jbGFzc0xpc3QuYWRkKFwidXNlci1kZXRhaWxzXCIpO1xuXG4gICAgICAvLyBDcmVhdGUgYXV0aG9yIGVsZW1lbnRcbiAgICAgIGNvbnN0IGF1dGhvckVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgICAgIGF1dGhvckVsZW1lbnQudGV4dENvbnRlbnQgPSBgJHtieX1gO1xuICAgICAgYXV0aG9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidXNlci1uYW1lXCIpO1xuXG4gICAgICAvLyBDcmVhdGUgdGltZSBlbGVtZW50XG4gICAgICBjb25zdCB0aW1lRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgICAgdGltZUVsZW1lbnQudGV4dENvbnRlbnQgPSB0aW1lU2luY2UodGltZSk7XG4gICAgICB0aW1lRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiY29tbWVudC10aW1lXCIpO1xuXG4gICAgICAvLyBDcmVhdGUgY29tbWVudC10ZXh0IGVsZW1lbnRcbiAgICAgIGNvbnN0IHRleHRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHRleHRFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJjb21tZW50LXRleHRcIik7XG4gICAgICAvLyBpbm5lckhUTUwgYmVjYXVzZSB0ZXh0IGNvbnRhaW5zIGh0bWwgZW1iZWRlZCBpbnNpZGUgaXQgc29cbiAgICAgIHRleHRFbGVtZW50LmlubmVySFRNTCA9IHRleHQ7XG5cbiAgICAgIC8vIFJlcGx5IGVsZW1lbnRcbiAgICAgIGNvbnN0IHJlcGx5SWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICByZXBseUljb24uY2xhc3NMaXN0LmFkZChcInJlcGx5LWljb25cIik7XG4gICAgICByZXBseUljb24uaW5uZXJIVE1MID0gYFxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnNcIj5jb21tZW50PC9zcGFuPlxuICAgICAgICAgICR7a2lkcyA/IGA8c3Bhbj4ke2tpZHMubGVuZ3RofTwvc3Bhbj5gIDogYDxzcGFuPjA8L3NwYW4+YH1cbiAgICAgIGA7XG5cbiAgICAgIC8vIEFwcGVuZCBlbGVtZW50cyB0byB0aGUgY29udGFpbmVyXG4gICAgICB1c2VyRGV0YWlscy5hcHBlbmQoYXV0aG9yRWxlbWVudCwgdGltZUVsZW1lbnQpO1xuICAgICAgZGl2LmFwcGVuZCh1c2VySWNvbiwgdXNlckRldGFpbHMsIHRleHRFbGVtZW50LCByZXBseUljb24pO1xuICAgICAgbm9kZS5hcHBlbmQoZGl2KTtcblxuICAgICAgLy8gRXZlbnQgTGlzdGVuZXJcbiAgICAgIGxldCBhY3RpdmUgPSBmYWxzZTtcbiAgICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZU9uQ29tbWVudENsaWNrKCkge1xuICAgICAgICAvLyBhY3RpdmUtPm9uY2UgY2xpY2tlZCBjb21tZW50IGRhdGEgZmV0Y2hlZCBub3cgd2hlbiBhZ2FpbiBjbGlja2VkIHRoZSBjb21tZW50IHdpbGwgYmUgaGlkZGVuIGFuZCB0b2dnbGUgd2l0aCBlYWNoIGNsaWNrIGJ1dCBubyBkYXRhIGZldGNoXG4gICAgICAgIGlmIChhY3RpdmUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICBpZiAoIWtpZHMpXG4gICAgICAgICAgICByZXBseUljb24ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZU9uQ29tbWVudENsaWNrKTtcbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBhd2FpdCByZW5kZXJDb21tZW50cyhraWRzKTtcbiAgICAgICAgICAgIGRpdi5hcHBlbmQobm9kZSk7XG4gICAgICAgICAgICAvLyByZXBseUljb24ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZU9uQ29tbWVudENsaWNrKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gVG8gc2hvdyBjb21tZW50IHdoZW4gY2xpY2tlZCBhbmQgaGlkZSB3aGVuIGFnYWluIGNsaWNrZWRcbiAgICAgICAgICBjb25zdCBpbm5lckNvbW1lbnRCb3ggPSBkaXYucXVlcnlTZWxlY3RvcihcIi5pbm5lci1jb21tZW50LWJveFwiKTtcbiAgICAgICAgICAvLyBzaW5jZSBkaXNwbGF5Om5vbmUgaXMgbm90IGluaGVyaXRlZCx3ZSBoYXZlIHRvIGFwcGx5IGhpZGUgb24gZXZlcnkgY29tbWVudCBhbmQgY2Fubm90IGp1c3QgYXBwbHkgaGlkZSBvbiBpbm5lci1jb21tZW50LWJveChyb290IGVsZW1lbnQpXG4gICAgICAgICAgY29uc3QgY29tbWVudHMgPSBpbm5lckNvbW1lbnRCb3gucXVlcnlTZWxlY3RvckFsbChcIi5jb21tZW50XCIpO1xuICAgICAgICAgIGNvbW1lbnRzLmZvckVhY2goKGNvbW1lbnQpID0+IGNvbW1lbnQuY2xhc3NMaXN0LnRvZ2dsZShcImhpZGVcIikpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJlcGx5SWNvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlT25Db21tZW50Q2xpY2spO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICBhc3luYyBmdW5jdGlvbiByZW5kZXJEZXRhaWxQYWdlKGVsZW1lbnQ6IElyZXR1cm5HZXRTdG9yeSkge1xuICAgIC8vIGRhdGFcbiAgICBjb25zdCB7IGJ5LCBraWRzLCBzY29yZSwgdGltZSwgdGl0bGUsIHVybCB9ID0gZWxlbWVudDtcblxuICAgIC8vIHNlbGVjdG9yXG4gICAgY29uc3QgaW5uZXJDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmlubmVyLWNvbnRhaW5lclwiKTtcbiAgICBjb25zdCBib29rbWFya19kaXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJvb2ttYXJrXCIpO1xuICAgIGNvbnN0IGNvbW1lbnRCb3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbW1lbnRCb3guY2xhc3NMaXN0LmFkZChcImNvbW1lbnQtYm94XCIpO1xuXG4gICAgLy8gY2xlYXJpbmdcbiAgICBib29rbWFya19kaXYuaW5uZXJIVE1MPVwiXCI7XG4gICAgaW5uZXJDb250YWluZXIuaW5uZXJIVE1MID0gXCJcIjtcblxuICAgIC8vIENyZWF0ZSBjb250YWluZXIgZGl2XG4gICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBkaXYuY2xhc3NMaXN0LmFkZChcImJveFwiKTtcblxuICAgIC8vIENyZWF0ZSB0aXRsZSBlbGVtZW50XG4gICAgY29uc3QgdGl0bGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgyXCIpO1xuICAgIHRpdGxlRWxlbWVudC50ZXh0Q29udGVudCA9IHRpdGxlO1xuXG4gICAgLy8gQ3JlYXRlIGF1dGhvciBlbGVtZW50XG4gICAgY29uc3QgYXV0aG9yRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xuICAgIGF1dGhvckVsZW1lbnQudGV4dENvbnRlbnQgPSBgJHtieX1gO1xuXG4gICAgLy8gQ3JlYXRlIFVSTCBlbGVtZW50XG4gICAgY29uc3QgdXJsRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3QgdXJsTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuICAgIHVybExpbmsuaHJlZiA9IHVybDtcbiAgICB1cmxMaW5rLnRhcmdldCA9IFwiX2JsYW5rXCI7XG4gICAgdXJsTGluay5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJtYXRlcmlhbC1pY29uc1wiPm9wZW5faW5fbmV3PC9zcGFuPmA7XG4gICAgdXJsRWxlbWVudC5hcHBlbmQodXJsTGluayk7XG5cbiAgICAvLyBDcmVhdGUgdGltZSBlbGVtZW50XG4gICAgY29uc3QgdGltZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgICB0aW1lRWxlbWVudC50ZXh0Q29udGVudCA9IHRpbWVTaW5jZSh0aW1lKTtcblxuICAgIC8vIENyZWF0ZSBhdXRob3IgZWxlbWVudFxuICAgIGNvbnN0IGNvbW1lbnRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gICAgY29tbWVudEVsZW1lbnQuaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnNcIj5jb21tZW50PC9zcGFuPiAke1xuICAgICAga2lkcy5sZW5ndGggPyBraWRzLmxlbmd0aCA6IFwiMFwiXG4gICAgfWA7XG5cbiAgICAvLyBBcHBlbmQgZWxlbWVudHMgdG8gdGhlIGNvbnRhaW5lclxuICAgIGRpdi5hcHBlbmRDaGlsZCh0aXRsZUVsZW1lbnQpO1xuICAgIGRpdi5hcHBlbmRDaGlsZChhdXRob3JFbGVtZW50KTtcbiAgICBkaXYuYXBwZW5kQ2hpbGQodXJsRWxlbWVudCk7XG4gICAgZGl2LmFwcGVuZENoaWxkKHRpbWVFbGVtZW50KTtcbiAgICBkaXYuYXBwZW5kQ2hpbGQoY29tbWVudEVsZW1lbnQpO1xuXG4gICAgLy8gTm93IEZvciBjb21tZW50czpcbiAgICBpZiAoa2lkcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGlubmVyQ29udGFpbmVyLmlubmVySFRNTCA9IFwiTm8gQ29tbWVudHMgdG8gU2hvd1wiO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBub2RlID0gYXdhaXQgcmVuZGVyQ29tbWVudHMoa2lkcyk7XG4gICAgICBjb21tZW50Qm94LmFwcGVuZChub2RlKTtcbiAgICB9XG5cbiAgICAvLyBBcHBlbmQgY29udGFpbmVyIHRvIHRoZSBib2R5XG4gICAgaW5uZXJDb250YWluZXIuYXBwZW5kKGRpdiwgY29tbWVudEJveCk7XG4gIH1cblxuICAvLyBUbyByZW5kZXIgYm9va21hcmtcbiAgZnVuY3Rpb24gcmVuZGVyQm9va21hcmsoKSB7XG4gICAgY29uc3QgYm9va21hcmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJvb2ttYXJrXCIpO1xuICAgIGNvbnN0IGJvb2ttYXJrZWRJdGVtOiBJcmV0dXJuR2V0U3RvcnlbXSA9XG4gICAgICBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiYm9va21hcmtcIikpIHx8IFtdO1xuXG4gICAgYm9va21hcmsuaW5uZXJIVE1MID0gXCJcIjtcbiAgICBib29rbWFya2VkSXRlbS5mb3JFYWNoKChzdG9yeTogSXJldHVybkdldFN0b3J5KSA9PiB7XG4gICAgICByZW5kZXJTdG9yeShzdG9yeSwgYm9va21hcmspO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gaW5zaWRlIGlubmVyQ29udGFpbmVyIGl0IHdpbGwgYmUgYXBwZW5kZWRcbiAgZnVuY3Rpb24gcmVuZGVyU3RvcnkoZWxlbWVudDogSXJldHVybkdldFN0b3J5LCBpbm5lckNvbnRhaW5lcjogRWxlbWVudCkge1xuICAgIC8vIGRhdGEgbmVlZGVkXG4gICAgY29uc3QgeyBieSwgdGltZSwgdXJsLCB0aXRsZSwga2lkcywgc2NvcmUgfSA9IGVsZW1lbnQ7XG5cbiAgICAvLyBDcmVhdGUgY29udGFpbmVyIGRpdlxuICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgZGl2LmNsYXNzTGlzdC5hZGQoXCJib3hcIik7XG5cbiAgICBjb25zdCB1cHBlcl9ib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHVwcGVyX2JveC5jbGFzc0xpc3QuYWRkKFwidXBwZXItYm94XCIpO1xuICAgIGNvbnN0IGxvd2VyX2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgbG93ZXJfYm94LmNsYXNzTGlzdC5hZGQoXCJsb3dlci1ib3hcIik7XG5cbiAgICAvLyBDcmVhdGUgdGl0bGUgZWxlbWVudFxuICAgIGNvbnN0IHRpdGxlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdGl0bGVFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0aXRsZVwiKTtcbiAgICB0aXRsZUVsZW1lbnQudGV4dENvbnRlbnQgPSB0aXRsZTtcblxuICAgIC8vIENyZWF0ZSBhdXRob3IgZWxlbWVudFxuICAgIGNvbnN0IGF1dGhvckVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGF1dGhvckVsZW1lbnQuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9XCJhdXRob3JcIj48c3BhbiBjbGFzcz1cIm1hdGVyaWFsLWljb25zXCI+cGVyc29uPC9zcGFuPiAke2J5fTwvZGl2PmA7XG5cbiAgICAvLyBDcmVhdGUgY29tbWVudCBlbGVtZW50XG4gICAgY29uc3QgY29tbWVudEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbW1lbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJjb21tZW50LWJveFwiKTtcbiAgICBjb21tZW50RWxlbWVudC5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJtYXRlcmlhbC1pY29uc1wiPmNvbW1lbnQ8L3NwYW4+PHNwYW4+JHtcbiAgICAgIGtpZHMgPyBraWRzLmxlbmd0aCA6IFwiMFwiXG4gICAgfTwvc3Bhbj5gO1xuXG4gICAgLy8gQ3JlYXRlIHNjb3JlIGVsZW1lbnRcbiAgICBjb25zdCBzY29yZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHNjb3JlRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwic2NvcmVcIik7XG4gICAgc2NvcmVFbGVtZW50LmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cIm1hdGVyaWFsLWljb25zXCI+c3Rhcjwvc3Bhbj48c3Bhbj4ke3Njb3JlfTwvc3Bhbj5gO1xuXG4gICAgLy8gQ3JlYXRlIHRpbWUgZWxlbWVudFxuICAgIGNvbnN0IHRpbWVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0aW1lRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGltZVwiKTtcbiAgICB0aW1lRWxlbWVudC5pbm5lckhUTUwgPSBgPGkgY2xhc3M9XCJtYXRlcmlhbC1pY29uc1wiPmFjY2Vzc190aW1lPC9pPiBQdWJsaXNoZWQgJHt0aW1lU2luY2UoXG4gICAgICB0aW1lXG4gICAgKX1gO1xuXG4gICAgLy8gQ3JlYXRlIFVSTCBlbGVtZW50XG4gICAgY29uc3QgdXJsRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3QgdXJsTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuICAgIHVybExpbmsuaHJlZiA9IHVybDtcbiAgICB1cmxMaW5rLnRhcmdldCA9IFwiX2JsYW5rXCI7XG4gICAgdXJsTGluay5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJtYXRlcmlhbC1pY29uc1wiPm9wZW5faW5fbmV3PC9zcGFuPmA7XG4gICAgdXJsRWxlbWVudC5hcHBlbmQodXJsTGluayk7XG5cbiAgICAvLyBDcmVhdGUgdGltZSBlbGVtZW50XG4gICAgY29uc3Qgc2F2ZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICBzYXZlRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwic2F2ZVwiKTtcbiAgICBzYXZlRWxlbWVudC5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJtYXRlcmlhbC1pY29uc1wiPmJvb2ttYXJrPC9zcGFuPmA7XG5cbiAgICAvLyBBcHBlbmQgY29udGFpbmVyIHRvIHRoZSBib2R5XG4gICAgdXBwZXJfYm94LmFwcGVuZCh0aXRsZUVsZW1lbnQpO1xuICAgIGxvd2VyX2JveC5hcHBlbmQoXG4gICAgICBhdXRob3JFbGVtZW50LFxuICAgICAgc2NvcmVFbGVtZW50LFxuICAgICAgY29tbWVudEVsZW1lbnQsXG4gICAgICB0aW1lRWxlbWVudCxcbiAgICAgIHVybEVsZW1lbnQsXG4gICAgICBzYXZlRWxlbWVudFxuICAgICk7XG4gICAgZGl2LmFwcGVuZCh1cHBlcl9ib3gsIGxvd2VyX2JveCk7XG4gICAgaW5uZXJDb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTtcblxuICAgIC8vIEV2ZW50IExpc3RlbmVyc1xuXG4gICAgLy8gVG8gc2hvdyBkZXRhaWwgcGFnZSAvIGNvbW1lbnQgc2VjdGlvblxuICAgIHRpdGxlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgcmVuZGVyRGV0YWlsUGFnZShlbGVtZW50KTtcbiAgICB9KTtcblxuICAgIC8vIFRvIGJvb2ttYXJrIHN0b3JpZXNcbiAgICBsZXQgYWN0aXZlID0gZmFsc2U7XG4gICAgc2F2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIC8vIFRvIGNoYW5nZSBjb2xvciBvZiB0aGUgYm9va21hcmsgaWNvblxuICAgICAgYWN0aXZlID0gIWFjdGl2ZTtcbiAgICAgIGNvbnNvbGUubG9nKGFjdGl2ZSlcbiAgICAgIC8vIHNlbGVjdG9yXG4gICAgICBjb25zdCBib29rbWFya19kaXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJvb2ttYXJrXCIpO1xuICAgICAgY29uc3QgYm9va21hcmtfaWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2F2ZVwiKTtcbiAgICAgIGNvbnN0IGljb24gPSBib29rbWFya19pY29uLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic3BhblwiKVswXSBhcyBIVE1MU3BhbkVsZW1lbnQ7XG4gICAgXG4gICAgICBhY3RpdmUgPyAoaWNvbi5zdHlsZS5jb2xvciA9IFwiYmx1ZVwiKSA6IChpY29uLnN0eWxlLmNvbG9yID0gXCJ3aGl0ZVwiKTtcblxuICAgICAgY29uc3QgYm9va21hcms6IElyZXR1cm5HZXRTdG9yeVtdID1cbiAgICAgICAgSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImJvb2ttYXJrXCIpKSB8fCBbXTtcbiAgICAgIGNvbnN0IGluZGV4ID0gYm9va21hcmsuZmluZEluZGV4KChzdG9yeSkgPT4gc3RvcnkuaWQgPT09IGVsZW1lbnQuaWQpO1xuICAgICAgaW5kZXggPT09IC0xID8gYm9va21hcmsucHVzaChlbGVtZW50KSA6IGJvb2ttYXJrLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICAgIC8vIHVwZGF0ZSBsb2NhbHN0b3JhZ2VcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiYm9va21hcmtcIiwgSlNPTi5zdHJpbmdpZnkoYm9va21hcmspKTtcblxuICAgICAgLy8gcmVuZGVyIGl0XG4gICAgICBib29rbWFya19kaXYuaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgIHJlbmRlckJvb2ttYXJrKCk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBUbyByZW5kZXIgdGhlIG1haW4gc3RvcmllcyBwYWdlc1xuICBhc3luYyBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgLy8gc2VsZWN0b3JzXG4gICAgY29uc3QgaW5uZXJDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmlubmVyLWNvbnRhaW5lclwiKTtcblxuICAgIC8vIFJlbmRlciBib29rbWFya1xuICAgIHJlbmRlckJvb2ttYXJrKCk7XG4gICAgLy8gUmVuZGVycyBza2VsZXRvbiBsb2FkaW5nXG4gICAgcmVuZGVyU2tlbGV0b24oKTtcblxuICAgIC8vIGZpbHRlcnMgYW5kIGdpdmVzIHVzIHRoZSBkYXRhIHRoYXQgc2hvdWxkIGJlIGZldGNoZWQgb24gdGhhdCBwYWdlO1xuICAgIGF3YWl0IGRhdGFGaWx0ZXIoKTtcblxuICAgIC8vIGNsZWFycyB0aGUgcmVuZGVyIGNhdXNlZCBieSBza2VsZXRvbi1sb2FkaW5nXG4gICAgaW5uZXJDb250YWluZXIuaW5uZXJIVE1MID0gXCJcIjtcblxuICAgIHN0b3J5LmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgIHJlbmRlclN0b3J5KGVsZW1lbnQsIGlubmVyQ29udGFpbmVyKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiB7IGluZGV4Tm8sIG5leHRQYWdlLCBwcmV2aW91c1BhZ2UsIGdvVG9JbmRleCwgcmVuZGVyIH07XG59XG4iXSwibmFtZXMiOlsiZ2V0RGF0YSIsImdldFN0b3JpZXMiLCJmZXRjaCIsImpzb24iLCJnZXRTdG9yeSIsImlkIiwiZ2V0Q29tbWVudCIsInRpbWVTaW5jZSIsImRhdGUiLCJub3dTZWNvbmRzIiwiRGF0ZSIsImdldFRpbWUiLCJkYXRlU2VjIiwic2Vjb25kcyIsIk1hdGgiLCJmbG9vciIsImludGVydmFsIiwidG9Mb2NhbGVEYXRlU3RyaW5nIiwiaW5uZXJfY29udGFpbmVyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibmF2aWdhdGlvbnMiLCJxdWVyeVNlbGVjdG9yQWxsIiwibmV4dF9idG4iLCJwcmV2X2J0biIsImVhY2hJbmRleCIsImluZGV4Tm8iLCJwYWdlIiwic3RvcmllcyIsInRvcFN0b3JpZXMiLCJzdG9yeSIsInN0b3J5Q2FjaGUiLCJkYXRhRmlsdGVyIiwibGVuZ3RoIiwic3RhcnQiLCJlbmQiLCJzbGljZSIsInRvU3RyaW5nIiwibWFwIiwic3RvcnlQcm9taXNlIiwiUHJvbWlzZSIsImFsbCIsInJlbmRlckNvbW1lbnRzIiwiY29tbWVudHMiLCJub2RlIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsImZvckVhY2giLCJoYW5kbGVPbkNvbW1lbnRDbGljayIsImFjdGl2ZSIsImtpZHMiLCJyZXBseUljb24iLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZGl2IiwiYXBwZW5kIiwiY29tbWVudCIsInRvZ2dsZSIsImRhdGEiLCJieSIsInRleHQiLCJ0aW1lIiwidXNlckljb24iLCJpY29uIiwidGV4dENvbnRlbnQiLCJhcHBlbmRDaGlsZCIsInVzZXJEZXRhaWxzIiwiYXV0aG9yRWxlbWVudCIsInRpbWVFbGVtZW50IiwidGV4dEVsZW1lbnQiLCJpbm5lckhUTUwiLCJhZGRFdmVudExpc3RlbmVyIiwicmVuZGVyQm9va21hcmsiLCJib29rbWFyayIsImJvb2ttYXJrZWRJdGVtIiwiSlNPTiIsInBhcnNlIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInJlbmRlclN0b3J5IiwiZWxlbWVudCIsImlubmVyQ29udGFpbmVyIiwidXJsIiwidGl0bGUiLCJzY29yZSIsInVwcGVyX2JveCIsImxvd2VyX2JveCIsInRpdGxlRWxlbWVudCIsImNvbW1lbnRFbGVtZW50Iiwic2NvcmVFbGVtZW50IiwidXJsRWxlbWVudCIsInVybExpbmsiLCJocmVmIiwidGFyZ2V0Iiwic2F2ZUVsZW1lbnQiLCJib29rbWFya19kaXYiLCJjb21tZW50Qm94IiwicmVuZGVyRGV0YWlsUGFnZSIsImNvbnNvbGUiLCJsb2ciLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInN0eWxlIiwiY29sb3IiLCJpbmRleCIsImZpbmRJbmRleCIsInB1c2giLCJzcGxpY2UiLCJzZXRJdGVtIiwic3RyaW5naWZ5IiwibmV4dFBhZ2UiLCJwcmV2aW91c1BhZ2UiLCJnb1RvSW5kZXgiLCJubyIsInJlbmRlciIsImkiLCJyZW5kZXJTa2VsZXRvbiIsIlBhZ2UiLCJidG4iLCJyZW1vdmUiLCJjb250YWlucyJdLCJzb3VyY2VSb290IjoiIn0=